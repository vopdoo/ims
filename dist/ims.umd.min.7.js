(("undefined"!==typeof self?self:this)["webpackJsonpims"]=("undefined"!==typeof self?self:this)["webpackJsonpims"]||[]).push([[7],{"51a3":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Row",{attrs:{gutter:32}},[n("Col",{attrs:{span:"20"}},[e._v("\n             \n        ")]),n("Col",{staticClass:"list-tlbr",attrs:{span:"4"}},[n("Button",{attrs:{type:"success"},on:{click:function(t){return e.addTopMenu()}}},[e._v("增加顶级部门")])],1)],1),n("Tree",{attrs:{data:e.nodes,render:e.renderContent}}),n("Modal",{attrs:{title:e.title,loading:e.loading,"class-name":"ce-modal","mask-closable":!1,scrollable:!0},on:{"on-ok":e.saveMenu,"on-cancel":e.cancelAddMenu},model:{value:e.is_add_menuing,callback:function(t){e.is_add_menuing=t},expression:"is_add_menuing"}},[n("Form",{ref:"menuFm",attrs:{model:e.menuFm,"label-position":"top",rules:e.menuFmRules}},[n("FormItem",{attrs:{label:"类型",prop:"type"}},[n("Select",{attrs:{placeholder:"类型"},on:{"on-change":e.typeChange},model:{value:e.menuFm.type,callback:function(t){e.$set(e.menuFm,"type",t)},expression:"menuFm.type"}},e._l(e.typeList,function(t){return n("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1),n("FormItem",{attrs:{label:"名称"}},[n("Input",{attrs:{placeholder:"名称"},model:{value:e.menuFm.name,callback:function(t){e.$set(e.menuFm,"name",t)},expression:"menuFm.name"}})],1),n("FormItem",{attrs:{label:"标识"}},[n("Input",{attrs:{placeholder:"标识"},model:{value:e.menuFm.code,callback:function(t){e.$set(e.menuFm,"code",t)},expression:"menuFm.code"}})],1),n("FormItem",{attrs:{label:"角色"}},[n("Select",{attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.menuFm.role_ids,callback:function(t){e.$set(e.menuFm,"role_ids",t)},expression:"menuFm.role_ids"}},e._l(e.roles.data,function(t){return n("Option",{key:t.id,attrs:{value:t.id}},[e._v("\n                        "+e._s(t.name)+"\n                    ")])}),1)],1),1==e.menuFm.type?n("div",[n("FormItem",{attrs:{label:"路由名称"}},[n("Input",{attrs:{placeholder:"路由名称"},model:{value:e.menuFm.options.name,callback:function(t){e.$set(e.menuFm.options,"name",t)},expression:"menuFm.options.name"}})],1),n("FormItem",{attrs:{label:"路由路径"}},[n("Input",{attrs:{placeholder:"路由路径"},model:{value:e.menuFm.options.path,callback:function(t){e.$set(e.menuFm.options,"path",t)},expression:"menuFm.options.path"}})],1)],1):e._e(),n("FormItem",{attrs:{label:"图标"}},[n("Input",{attrs:{placeholder:"图标"},model:{value:e.menuFm.icon,callback:function(t){e.$set(e.menuFm,"icon",t)},expression:"menuFm.icon"}})],1),n("FormItem",{attrs:{label:"排序"}},[n("InputNumber",{attrs:{max:9999,min:0,placeholder:"排序值 越小越靠前"},model:{value:e.menuFm.sort,callback:function(t){e.$set(e.menuFm,"sort",t)},expression:"menuFm.sort"}})],1),n("Alert",{attrs:{closable:""}},[e._v(e._s(e.menuFm))])],1)],1)],1)},i=[],a=n("2f62"),o={name:"Departments",async created(){await this.$store.dispatch("department/lists",{is_show_tree:1}),await this.$store.dispatch("role/lists",{status:1,per_page:100}),await this.$store.dispatch("system/changeSpining",{spining:!1})},computed:{...Object(a["c"])({nodes:"department/nodes",roles:"role/lists"})},data(){const e=(e,t,n)=>{if(!t)return n(new Error("值不能为空"));let s={type:e.field,value:t,id:this.menuFm.id};this.$store.dispatch("validateCode",s).then(e=>{e?n(new Error("已经存在了，请重新输入！")):n()})};return{title:"增加节点",typeList:[{value:1,label:"页面"},{value:2,label:"菜单"},{value:3,label:"操作"}],menuFm:{name:"",code:"",type:1,role_ids:[],options:{tree_path:"0"},icon:"md-apps",sort:0,pid:0},loading:!0,menuFmRules:{name:[{required:!0,message:"菜单名称不能为空",trigger:"blur"},{type:"string",min:2,message:"至少2个字符",trigger:"blur"}],code:[{required:!0,message:"节点标识不能为空",trigger:"blur"},{type:"string",min:2,message:"至少2个字符",trigger:"blur"},{validator:e,trigger:"blur"}],sort:[{required:!1,type:"integer",message:"排序只能是数字",trigger:"blur"}]},is_add_menuing:!1,buttonProps:{size:"small"}}},methods:{getNodeTag(e){return 1==e?"#2d8cf0":2==e?"#19be6b":"#f90"},typeChange(e){console.info(e)},createNode(e){this.menuFm.pid=e.pid,e.pid>0?1==e.type?this.menuFm.type=3:2==e.type&&(this.menuFm.type=1):this.menuFm.type=2,this.title="增加节点",this.is_add_menuing=!0},editNode(e){this.title="编辑节点",this.menuFm={name:e.name,code:e.code,type:e.type,options:e.options,icon:e.icon,sort:0,pid:e.pid,role_ids:e.role_ids,id:e.id},this.is_add_menuing=!0},renderContent(e,{root:t,node:n,data:s}){let i=[];return s.roles.forEach(t=>{i.push(e("Tag",t.name))}),e("span",{class:{"menus-span":!0},style:{display:"inline-block",width:"100%"}},[e("span",[e("Icon",{props:{type:s.icon,color:this.getNodeTag(s.type)},style:{marginRight:"8px"}}),e("span",s.name),e("span",{style:{marginLeft:"6px"}},i)]),e("span",{style:{display:"inline-block",float:"right",marginRight:"16px"}},[e("Button",{props:Object.assign({},this.buttonProps,{icon:"ios-add",disabled:3==s.type}),style:{marginRight:"8px"},on:{click:()=>{this.createNode(s)}}}),e("Button",{props:Object.assign({},this.buttonProps,{icon:"ios-create-outline"}),style:{marginRight:"8px"},on:{click:()=>{this.editNode(s)}}}),e("Poptip",{props:{confirm:!0,title:"确认要删除",transfer:!0},on:{"on-ok":()=>{this.remove(t,n,s)}}},[e("Button",{props:Object.assign({},this.buttonProps,{icon:"ios-remove",disabled:s.children&&!0})})])])])},addTopMenu(){this.initFmData(),this.createNode(this.menuFm)},cancelAddMenu(){this.initFmData()},initFmData(){this.menuFm={name:"",code:"",type:1,options:{tree_path:"0"},icon:"md-apps",sort:0,pid:0}},saveMenu(){this.$refs["menuFm"].validate(e=>{if(!e)return this.loading=!this.loading,!1;{this.loading=!this.loading;let e="department/create";this.menuFm.id&&this.menuFm.id>0&&(e="department/edit"),this.$store.dispatch(e,this.menuFm).then(e=>{this.loading=!this.loading,this.cancelAddMenu(),this.is_add_menuing=!1}).catch(e=>{return this.loading=!this.loading,this.$Message.error("保存失败，请重试!"),!1})}})},append(e){const t=e.children||[];t.push({title:"appended node",expand:!0}),this.$set(e,"children",t)},remove(e,t,n){this.$store.dispatch("department/delete",{id:n.id}).then(e=>{})}}},l=o,r=(n("5864"),n("2877")),m=Object(r["a"])(l,s,i,!1,null,null,null);t["default"]=m.exports},"52ab":function(e,t,n){},5864:function(e,t,n){"use strict";var s=n("52ab"),i=n.n(s);i.a}}]);
//# sourceMappingURL=ims.umd.min.7.js.map